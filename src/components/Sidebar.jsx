import { useEffect, useState } from "react";
import ProfileInfo from "./ProfileInfo";
import { NavLink, useNavigate } from "react-router-dom";
import { apiRequest } from "../utils/axios";

import socket from "../utils/socket";


function SideBar() {
    const [userData, setUserData] = useState({});
    const [isLoading, setIsLoading] = useState(true);

    const navigate = useNavigate();

    const fetchUserData = async () => {
        setIsLoading(true);

        try {
            const { data } = await apiRequest({
                method: 'GET',
                url: '/user-data',
                headers: {
                    Authorization: `Bearer ${localStorage.getItem("token")}`
                }
            });

            setUserData(data);
        } catch (error) {
            console.log(error);
        } finally {
            setIsLoading(false)
        }
    };

    useEffect(() => {
        fetchUserData()
    }, []);

    const handleLogout = () => {
        localStorage.removeItem("token");
        navigate("/login")
    };

    return (
        <div className="col-span-3 flex flex-col bg-slate-50 px-3 py-5 items-center gap-6 z-20 shadow-md">
            {isLoading ? (<></>) : (<>
                <ProfileInfo userData={userData} />
                <div className="grow flex flex-col">
                    <div className="grow flex flex-col gap-5">
                        <div className="flex gap-3 hover:cursor-pointer">
                            <svg className="w-[29px] h-[29px] text-slate-700 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                <path fill-rule="evenodd" d="M4 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h1v2a1 1 0 0 0 1.707.707L9.414 13H15a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1H4Z" clip-rule="evenodd" />
                                <path fill-rule="evenodd" d="M8.023 17.215c.033-.03.066-.062.098-.094L10.243 15H15a3 3 0 0 0 3-3V8h2a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1h-1v2a1 1 0 0 1-1.707.707L14.586 18H9a1 1 0 0 1-.977-.785Z" clip-rule="evenodd" />
                            </svg>
                            <NavLink to="/">
                                <p className="font-semibold text-slate-700">Messages</p>
                            </NavLink>
                        </div>

                        <div className="flex gap-3 hover:cursor-pointer">
                            <svg className="w-[29px] h-[29px] text-slate-700 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                <path fill-rule="evenodd" d="M8 4a4 4 0 1 0 0 8 4 4 0 0 0 0-8Zm-2 9a4 4 0 0 0-4 4v1a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-1a4 4 0 0 0-4-4H6Zm7.25-2.095c.478-.86.75-1.85.75-2.905a5.973 5.973 0 0 0-.75-2.906 4 4 0 1 1 0 5.811ZM15.466 20c.34-.588.535-1.271.535-2v-1a5.978 5.978 0 0 0-1.528-4H18a4 4 0 0 1 4 4v1a2 2 0 0 1-2 2h-4.535Z" clip-rule="evenodd" />
                            </svg>
                            <NavLink to="/contact">
                                <p className="font-semibold text-slate-700">Contacts</p>
                            </NavLink>
                        </div>

                        <div className="flex gap-3 hover:cursor-pointer">
                            <svg className="w-[29px] h-[29px] text-slate-700 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                <path fill-rule="evenodd" d="M4 4a1 1 0 0 1 1-1h1.5a1 1 0 0 1 .979.796L7.939 6H19a1 1 0 0 1 .979 1.204l-1.25 6a1 1 0 0 1-.979.796H9.605l.208 1H17a3 3 0 1 1-2.83 2h-2.34a3 3 0 1 1-4.009-1.76L5.686 5H5a1 1 0 0 1-1-1Z" clip-rule="evenodd" />
                            </svg>
                            <NavLink to="/marketplace">
                                <p className="font-semibold text-slate-700">Marketplace</p>
                            </NavLink>
                        </div>

                        <div className="flex gap-3 hover:cursor-pointer">
                            <svg class="w-[29px] h-[29px] text-slate-700 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                <path fill-rule="evenodd" d="M9.586 2.586A2 2 0 0 1 11 2h2a2 2 0 0 1 2 2v.089l.473.196.063-.063a2.002 2.002 0 0 1 2.828 0l1.414 1.414a2 2 0 0 1 0 2.827l-.063.064.196.473H20a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2h-.089l-.196.473.063.063a2.002 2.002 0 0 1 0 2.828l-1.414 1.414a2 2 0 0 1-2.828 0l-.063-.063-.473.196V20a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-.089l-.473-.196-.063.063a2.002 2.002 0 0 1-2.828 0l-1.414-1.414a2 2 0 0 1 0-2.827l.063-.064L4.089 15H4a2 2 0 0 1-2-2v-2a2 2 0 0 1 2-2h.09l.195-.473-.063-.063a2 2 0 0 1 0-2.828l1.414-1.414a2 2 0 0 1 2.827 0l.064.063L9 4.089V4a2 2 0 0 1 .586-1.414ZM8 12a4 4 0 1 1 8 0 4 4 0 0 1-8 0Z" clip-rule="evenodd" />
                            </svg>
                            <NavLink>
                                <p className="font-semibold text-slate-700">Settings</p>
                            </NavLink>
                        </div>
                    </div>
                    <div className="flex flex-col gap-5">
                        <div
                            onClick={handleLogout}
                            className="flex gap-3 hover:cursor-pointer"
                        >
                            <svg class="w-[29px] h-[29px] text-slate-700 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H8m12 0-4 4m4-4-4-4M9 4H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h2" />
                            </svg>
                            <p className="font-semibold text-slate-700">Log Out</p>
                        </div>
                    </div>
                </div>
            </>)}
        </div>
    )
};

export default SideBar;